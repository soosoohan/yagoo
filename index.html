<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìˆ«ìì•¼êµ¬</title>
<style>
  :root { --bg:#0b1520; --card:#122233; --accent:#6ee7ff; --muted:#9db3c7; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui, sans-serif; background: var(--bg); color:#eef6ff; display:flex; min-height:100vh; }
  .wrap { margin:auto; width:min(720px, 100%); padding:24px; }
  .card { background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:22px; box-shadow: 0 10px 30px rgba(0,0,0,.35);}
  h1 { margin:0 0 8px; font-size: 30px;}
  .sub { color:var(--muted); margin-bottom:18px; font-size: 20px; }
  .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  input[type="text"]{
    flex:1 1 auto;
    width: 420px;
    font-size: 20px;
    padding: 14px 16px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background:#0f1c2a; color:#e9f5ff; letter-spacing:6px; text-align:center;
  }

input#guess {
    font-size: 20px;
    background: #1e3a52; /* â† ì´ ë¶€ë¶„ì´ ë°°ê²½ìƒ‰ì…ë‹ˆë‹¤ */
    border: 3px solid #2c4157;
    color: white;
}

  button { cursor:pointer; border:0; border-radius:12px; padding:12px 16px; font-size:20px; }
  .primary { background:var(--accent); color:#00121d; }
  .secondary { background:#2c4157; color:#d7e7f5; }
  .ghost { background:transparent; color:var(--muted); border:1px dashed rgba(255,255,255,.2); }
  button:disabled { opacity:.45; cursor:not-allowed; }
  .hint { margin-top:10px; color:var(--muted); font-size:20px;}
  .warn { margin-top:6px; color:#ffb8c1; font-size:20px; min-height:1.3em; }
  .log { margin-top:18px; background:#0f1c2a; border-radius:14px; border:1px solid rgba(255,255,255,.08); max-height:50vh; overflow:auto;}
  .log table { width:100%; border-collapse:collapse; font-variant-numeric: tabular-nums; font-size:20px; }
  .log th, .log td { padding:12px 12px; border-bottom:1px solid rgba(255,255,255,.06); text-align:center; }
  .log tr:last-child td { border-bottom:0; }
  .badge { cursor:pointer; border:0; border-radius:12px; padding:12px 16px; font-size:20px;display:inline-block;  background:#ff6b6b;}
  .footer { margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  .mode-buttons { display:flex; gap:8px; margin-bottom:14px; flex-wrap:wrap; }
  .ok { color:#b8ffb8; }
  .fail { color:#ffb8c1; }
#modeLabel:empty {
  display: none;
}
/* ì„ íƒ ì‚¬í•­: ìƒˆ ê²Œì„ ë²„íŠ¼ ì£¼ëª© íš¨ê³¼ */
.attention {
  animation: pulse 1.2s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { transform: scale(1); box-shadow: 0 0 0 rgba(0,0,0,0); }
  50% { transform: scale(1.03); box-shadow: 0 8px 20px rgba(0,0,0,.25); }
}
/* í†µê³„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.stats-btn { background:#ff6b6b; color:white; }
.stats-btn:hover { background:#ff5252; }

input#guess {
font-size: 20px;
background: var(â€“bg);
border: 3px solid #2c4157;
color:white;
}

/* ì‹ ê¸°ë¡ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.record-modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.8);
}

.record-modal-content {
background: var(â€“card);
margin: 10% auto;
padding: 30px;
border-radius: 20px;
width: 90%;
max-width: 500px;
text-align: center;
position: relative;
border: 1px solid rgba(255,255,255,.2);
box-shadow: 0 20px 40px rgba(0,0,0,.5);
}

.record-close {
color: var(â€“muted);
float: right;
font-size: 28px;
font-weight: bold;
cursor: pointer;
position: absolute;
right: 20px;
top: 15px;
}

.record-close:hover {
color: white;
}

.record-celebration {
font-size: 4em;
margin: 20px 0;
}

.record-title {
color: var(â€“accent);
font-size: 2em;
margin: 20px 0;
}

.record-message {
color: #eef6ff;
font-size: 1.2em;
margin: 20px 0;
}

.record-buttons {
display: flex;
gap: 15px;
justify-content: center;
margin-top: 30px;
}

.record-buttons button {
padding: 15px 25px;
font-size: 18px;
}
</style>

</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ìˆ«ì ì•¼êµ¬ </h1>
    <div style="margin:10px 0;padding:10px 14px;border:1px solid #ccc;border-radius:8px;background:#143148;color:#d7e7f5;font-size:20px;line-height:1.6">
  <strong>ê²Œì„ ê·œì¹™:</strong> 
  ë¹„ë°€ ìˆ«ìë¥¼ ë§ì¶”ëŠ” ê³ ì „ í¼ì¦ì…ë‹ˆë‹¤.<br>
  - ì„œë¡œ ë‹¤ë¥¸ ìˆ«ìë¡œ êµ¬ì„±ëœ ë¹„ë°€ ì½”ë“œë¥¼ ì¶”ì¸¡í•©ë‹ˆë‹¤.<br>
  - <b>S(ìŠ¤íŠ¸ë¼ì´í¬)</b>: ìˆ«ìì™€ ìë¦¬ ëª¨ë‘ ë§ìŒ<br>
  - <b>B(ë³¼)</b>: ìˆ«ìëŠ” ë§ì§€ë§Œ ìë¦¬ ë‹¤ë¦„<br>
  - <b>OUT(ì•„ì›ƒ)</b>: ì—†ëŠ” ìˆ«ì<br>
  ëª¨ë“  ìë¦¬ë¥¼ ë§ì¶”ë©´ ìŠ¹ë¦¬!
</div>

<div class="mode-buttons">
      <button class="secondary" id="m3e">3ìë¦¬ 1~9</button>
      <button class="secondary" id="m3i">3ìë¦¬ 0~9</button>
      <button class="secondary" id="m4e">4ìë¦¬ 1~9</button>
      <button class="secondary" id="m4i">4ìë¦¬ 0~9</button>
    </div>
    

<div class="row">
  <input id="guess" autocomplete="off" inputmode="numeric" maxlength="4" placeholder="ì˜ˆ: 573" />
  <button id="btn-try" class="primary" disabled>ì œì¶œ</button>
  <button id="btn-reset" class="secondary">ìƒˆ ê²Œì„</button>
  <button id="btn-giveup" class="ghost">í¬ê¸°</button>
 <span id="status" class="badge">ëª¨ë“œë¥¼  ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</span>
  <span id="modeLabel" class="badge"></span>
<span id="summary" class="hint"></span>
</div>
<div id="warn" class="warn"></div>

<div class="hint">1S=ìë¦¬Â·ìˆ«ì ì¼ì¹˜, 1B=ìˆ«ìë§Œ ì¡´ì¬. ë‚˜ë¨¸ì§€ëŠ” OUT.</div>

<div class="log">
  <table>
    <thead>
      <tr><th>#</th><th>ì¶”ì¸¡</th><th>ê²°ê³¼</th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>


  </div>
</div>

<!-- ì‹ ê¸°ë¡ ì¶•í•˜ ëª¨ë‹¬ -->

<div id="recordModal" class="record-modal">
  <div class="record-modal-content">
    <span class="record-close" onclick="closeRecordModal()">&times;</span>
    <div class="record-celebration" id="recordCelebration">ğŸ‰</div>
    <h2 class="record-title" id="recordTitle">ì‹ ê¸°ë¡ ë‹¬ì„±!</h2>
    <p class="record-message" id="recordMessage"></p>
    <div class="record-buttons">
      <button class="primary" onclick="closeRecordModal()">í™•ì¸</button>
      <button class="stats-btn" onclick="location.href='stats.html'">í†µê³„ ë³´ê¸°</button>
    </div>
  </div>
</div>

<script src="records.js"></script>

<script>
(function () {
  const $ = sel => document.querySelector(sel);
  const guessEl = $("#guess"), tbody = $("#tbody"), statusEl = $("#status"),
        summaryEl = $("#summary"), btnTry = $("#btn-try"),
        btnReset = $("#btn-reset"), btnGiveup = $("#btn-giveup"),
        warnEl = $("#warn"), modeLabel = $("#modeLabel");

  let secret = "", tries = 0, finished = false;
  let mode = null; // {len:3|4, zero:true|false}
  let currentModeKey = null; // m3e, m3i, m4e, m4i

  const modes = {
    m3e: {len:3, zero:false, label:"3ìë¦¬ Â· 0 ì œì™¸"},
    m3i: {len:3, zero:true, label:"3ìë¦¬ Â· 0 í¬í•¨"},
    m4e: {len:4, zero:false, label:"4ìë¦¬ Â· 0 ì œì™¸"},
    m4i: {len:4, zero:true, label:"4ìë¦¬ Â· 0 í¬í•¨"}
  };

  Object.keys(modes).forEach(id=>{
    $("#"+id).addEventListener("click", ()=>{
      mode = modes[id];
      currentModeKey = id;
      modeLabel.textContent = mode.label;
      reset();
    });
  });

  function newSecret() {
    let digits = mode.zero ? ["0","1","2","3","4","5","6","7","8","9"] : ["1","2","3","4","5","6","7","8","9"];
    for (let i = digits.length - 1; i > 0; i--) {
      const r = Math.floor(Math.random() * (i + 1));
      [digits[i], digits[r]] = [digits[r], digits[i]];
    }
    // ì²«ìë¦¬ 0 ë°©ì§€
    if (digits[0] === "0") {
      for (let i = 1; i < digits.length; i++) {
        if (digits[i] !== "0") { [digits[0], digits[i]] = [digits[i], digits[0]]; break; }
      }
    }
    return digits.slice(0, mode.len).join("");
  }

  

function reset() {
  if (!mode) { warnEl.textContent = "ë¨¼ì € ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."; return; }
  secret = newSecret();
  tries = 0; finished = false;
  tbody.innerHTML = "";
  statusEl.textContent = "ì§„í–‰ ì¤‘";
  statusEl.classList.remove("ok","fail");
  summaryEl.textContent = "";
  warnEl.textContent = "";
  guessEl.value = "";
  btnTry.disabled = true;
  guessEl.maxLength = mode.len;
  guessEl.placeholder = (mode.len === 3) ? "ì˜ˆ: 573" : "ì˜ˆ: 5073";
  guessEl.focus();

  updateButtons(false);        // â† ì¶”ê°€: ì§„í–‰ ì¤‘ UI
}


  function validate(input) {
    if (!mode) return "ëª¨ë“œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.";
    if (input.length < mode.len) return `${mode.len}ìë¦¬ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.`;
    let regex = mode.zero ? /^\d+$/ : /^[1-9]+$/;
    if (!regex.test(input)) return mode.zero ? "0~9 ìˆ«ìë§Œ" : "1~9 ìˆ«ìë§Œ (0 ê¸ˆì§€)";
    if (new Set(input).size !== mode.len) return "ëª¨ë“  ìˆ«ìëŠ” ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤.";
    if (input[0] === "0") return "ì²« ìë¦¬ì— 0 ë¶ˆê°€";
    return "";
  }

  function score(guess, ans) {
    let s = 0, b = 0;
    for (let i = 0; i < guess.length; i++) {
      if (guess[i] === ans[i]) s++;
      else if (ans.includes(guess[i])) b++;
    }
    return { s, b, outs: guess.length - (s+b) };
  }

  function addRow(guess, s, b, outs) {
    let result = `${s}S ${b}B`;
    if (outs > 0) result += ` ${outs}OUT`;
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${tries}</td><td><strong>${guess}</strong></td><td>${result}</td>`;
    tbody.prepend(tr);
  }

  // ê¸°ì¡´ í•¨ìˆ˜ë“¤ ì œê±°í•˜ê³  í•„ìš”í•œ í•¨ìˆ˜ë§Œ ìœ ì§€
  function showRecordModal(rank, attempts, modeKey) {
    const modal = $("#recordModal");
    const celebration = $("#recordCelebration");
    const title = $("#recordTitle");
    const message = $("#recordMessage");

    const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
    const medal = rank <= 3 ? medals[rank - 1] : 'ğŸ†';
    const modeName = recordsManager.getModeLabel(modeKey);

    celebration.textContent = medal;
    title.textContent = `${rank}ë“± ì‹ ê¸°ë¡!`;
    message.innerHTML = `<strong>${modeName}</strong><br>${attempts}ë²ˆ ë§Œì— ë§ì¶°ì„œ ${rank}ìœ„ì— ì˜¬ëìŠµë‹ˆë‹¤!`;

    modal.style.display = 'block';
  }

  function closeRecordModal() {
    $("#recordModal").style.display = 'none';
  }

  
function onTry() {
    if (finished || !mode) return;
    const g = guessEl.value.trim();
    const err = validate(g);
    if (err) { warnEl.textContent = err; guessEl.focus(); return; }
    warnEl.textContent = "";
    tries++;
    const { s, b, outs } = score(g, secret);
    addRow(g, s, b, outs);
    

if (s === mode.len) {
  finished = true;
  statusEl.textContent = `ì •ë‹µ! (${secret})`;
  statusEl.classList.add("ok");
  summaryEl.textContent = `ì‹œë„ íšŸìˆ˜: ${tries}ë²ˆ`;
  btnTry.disabled = true;

  updateButtons(true);         // â† ì¶”ê°€: ëë‚œ UI

  if (currentModeKey) {
    const result = recordsManager.addRecord(currentModeKey, tries);
    if (result.isNewRecord) {
      showRecordModal(result.rank, tries, currentModeKey);
    }
  }
} else {
  summaryEl.textContent = `ì‹œë„ ${tries}ë²ˆ`;
}

    guessEl.value = "";
    btnTry.disabled = true;
    guessEl.focus();
  }


function giveUp() {
  if (finished || !mode) return;
  finished = true;
  statusEl.textContent = `í¬ê¸°! ì •ë‹µ: ${secret}`;
  statusEl.classList.add("fail");
  btnTry.disabled = true;

  updateButtons(true);         // â† ì¶”ê°€: ëë‚œ UI
}


 
function updateButtons(isFinished) {
  // ì œì¶œ ë²„íŠ¼: ëë‚¬ìœ¼ë©´ ëœ ëˆˆì— ë„ê²Œ(secondary), ì§„í–‰ ì¤‘ì´ë©´ primary
  btnTry.classList.toggle("primary", !isFinished);
  btnTry.classList.toggle("secondary", isFinished);

  // ìƒˆ ê²Œì„ ë²„íŠ¼: ëë‚¬ìœ¼ë©´ ëˆˆì— ë„ê²Œ(primary), ì§„í–‰ ì¤‘ì´ë©´ secondary
  btnReset.classList.toggle("primary", isFinished);
  btnReset.classList.toggle("secondary", !isFinished);

  // ì„ íƒ: ìƒˆ ê²Œì„ ë²„íŠ¼ì— ì£¼ëª© íš¨ê³¼
  btnReset.classList.toggle("attention", isFinished);
}

  function onInput(e) {
    let v = e.target.value.replace(/[^\d]/g, "").slice(0, mode ? mode.len : 4);
    e.target.value = v;
    const err = validate(v);
    btnTry.disabled = !!err;
    warnEl.textContent = (v.length === (mode ? mode.len : 0) && err) ? err : "";
  }

  // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ëª¨ë‹¬ì—ì„œ ì‚¬ìš©)
  window.closeRecordModal = closeRecordModal;

  // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
  window.onclick = function(event) {
    const modal = $("#recordModal");
    if (event.target === modal) {
      closeRecordModal();
    }
  }

  guessEl.addEventListener("input", onInput);
  guessEl.addEventListener("keydown", e => { if (e.key === "Enter" && !btnTry.disabled) onTry(); });
  btnTry.addEventListener("click", onTry);
  btnReset.addEventListener("click", reset);
  btnGiveup.addEventListener("click", giveUp);
})();
</script>

</body>
</html>
