<!DOCTYPE html>
<html lang="ko">
<head>
<!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4YZHC1G9FN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4YZHC1G9FN');
    </script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>수수한글야구쉬움</title>
<style>
  :root { --bg:#0b1520; --card:#122233; --accent:#6ee7ff; --muted:#9db3c7;
          --hit:#8fd3ff; --out:#ff9bb3; --idle:#7b8ea3; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui, sans-serif; background: var(--bg); color:#eef6ff; display:flex; min-height:100vh; }
  .wrap { margin:auto; width:min(820px, 100%); padding:24px; }
  .card { background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:22px; box-shadow: 0 10px 30px rgba(0,0,0,.35);}
  h1 { margin:0 0 8px; font-size: 25px;}
  .sub { color:var(--muted); margin-bottom:18px; font-size: 20px; }
  .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

  input {
    font: inherit;
    padding: 14px 16px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: #0f1c2a;
    color: #e9f5ff;
    text-align: center;
    min-width:260px;
    font-size:20px;
  }
  button { cursor:pointer; border:0; border-radius:12px; padding:12px 16px; font-size:18px; }
  .primary { background:var(--accent); color:#00121d; }
  .secondary { background:#2c4157; color:#d7e7f5; }
  .ghost { background:transparent; color:var(--muted); border:1px dashed rgba(255,255,255,.2); }
  button:disabled { opacity:.45; cursor:not-allowed; }
  .hint { margin-top:10px; color:#c7d9eb; font-size:20px;}
  .warn { margin-top:6px; color:#ffb8c1; font-size:20px; min-height:1.3em; }
  .log { margin-top:18px; background:#0f1c2a; border-radius:14px; border:1px solid rgba(255,255,255,.08); max-height:46vh; overflow:auto;}
  .log table { width:100%; border-collapse:collapse; font-variant-numeric: tabular-nums; font-size:18px; }
  .log th, .log td { padding:12px 12px; border-bottom:1px solid rgba(255,255,255,.06); text-align:center; }
  .log tr:last-child td { border-bottom:0; }
  .badge { display:inline-block; border-radius:12px; padding:8px 12px; font-size:20px; background:#21415c; color:#d7e7f5;}
  .ok { color:#b8ffb8; }
  .fail { color:#ffb8c1; }
  .attention { animation: pulse 1.2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.03)} }

  /* 모드 버튼 active 스타일 */
  .mode-buttons { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
  .mode-buttons .secondary.active {
    background: var(--accent);
    color: #00121d;
    font-weight: 700;
    box-shadow: 0 0 0 2px rgba(110,231,255,.25) inset;
  }

  /* 자음 키보드 */
  .kb { margin-top:14px; display:grid; grid-template-columns: repeat(auto-fit, minmax(44px,1fr)); gap:8px; }
  .key {
    padding:10px 8px; border-radius:10px; text-align:center; font-size:20px;
    background:#1a2f44; color:#d0ddea; border:1px solid rgba(255,255,255,.08);
    user-select:none;
  }
  .key.idle { background:#1a2430; color:#d0ddea; border-color:rgba(255,255,255,.1); }
  .key.hit  { background:var(--hit); color:#062033; border-color:transparent; font-weight:700; }
  .key.out  { background:#f2c9d4; color:#3a0010; border-color:transparent; font-weight:700; }
  .flex { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
/* 결과 칸: 음절별(S/B/O) 박스 */


.result { display:flex; gap:8px; justify-content:center; }
.sy {
  display:flex; flex-direction:column; gap:4px; align-items:center;
}
.sy .slot-row { display:flex; gap:4px; }
.sy .slot {
  border:1px solid rgba(255,255,255,.25);
  border-radius:6px; padding:2px 4px;
  font-weight:800; font-size:14px;
  min-width:18px; text-align:center;
}
.sy .slot.s { border-color:#6ee7ff; color:#6ee7ff; }
.sy .slot.b { border-color:#ffd166; color:#ffd166; }
.sy .slot.o { border-color:#8697a9; color:#8697a9; }

</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>수수한글야구쉬움</h1>
    <div class="sub">
컴퓨터가 선택한 비밀 한글 단어를 맞히는 게임입니다.<br>
받침이 없는 단어들로 워드풀이 구성되었습니다.<br>
S: 위치가 맞은 자음 <br> B: 자음이 있으나 위치가 다름 <br> Out: 자음이 없음<br>
정답을 맞히거나 시도 횟수를 모두 사용하면 게임이 종료됩니다.
    </div>

    <div class="mode-buttons">
      <button class="secondary" id="m2">2글자</button>
      <button class="secondary" id="m3">3글자</button>
      <button class="secondary" id="m4">4글자</button>
      <button class="secondary" id="m5">5글자</button>
    </div>

    <div class="flex" style="margin-bottom:8px;">
      <!-- 모드 배지 제거: “2글자” 같은 표시를 없앰 -->
      <span id="vowelHint" class="hint"></span>
    </div>

    <div class="row">
      <input id="guess" autocomplete="off" placeholder="힌트와 같은 모음으로 단어 입력" />
      <button id="btn-try" class="primary" disabled>제출</button>
      <button id="btn-reset" class="secondary">새 게임</button>
      <button id="btn-giveup" class="ghost">포기</button>
      <span id="status" class="badge">글자 수를 선택하세요.</span>
      <span id="summary" class="hint"></span>
    </div>
    <div id="warn" class="warn"></div>

    <div class="log">
      <table>
        <thead>
          <tr><th>#</th><th>추측</th><th>결과</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="hint">자음 힌트  <span class="key idle" style="padding:2px 8px;">미시도</span> <span class="key hit" style="padding:2px 8px;">있음:S/B</span> <span class="key out" style="padding:2px 8px;">없음:OUT</span></div>
    <div id="kb" class="kb" aria-label="자음 키보드(상태 표시용)"></div>
  </div>
</div>

<script>
(function () {
  const $ = sel => document.querySelector(sel);
  const guessEl = $("#guess"), tbody = $("#tbody"), statusEl = $("#status"),
        summaryEl = $("#summary"), btnTry = $("#btn-try"),
        btnReset = $("#btn-reset"), btnGiveup = $("#btn-giveup"),
        warnEl = $("#warn"), vowelHintEl = $("#vowelHint"),
        kbEl = $("#kb");

  // ——— 단어뱅크: 글자수 섞어서 한 배열로 관리 ———
  // 원래 있던 예시들을 하나로 합침. 여기다 자유롭게 섞어서 추가하세요.
   const WORDS = [
"가게","가구","가다","가로","가루","가사","가수","가스","가요","가위","가지","가짜","가치","개다","개미","거기","거리","거의","겨우","겨자","계좌","고개","고교","고기","고려","고모","고추","과거","과외","과자","과제","교내","교대","교류","교사","교수","교시","교외","교재","교체","교포","교회","구두","구조","귀가","규모","그거","그녀","그대","그때","그래","그루","그리","그저","그해","기계","기구","기기","기다","기대","기도","기사","기여","기자","기차","기초","기타","기호","기회","기후","까다","까치","깨다","꼬리","꼬마","꾸다","끄다","끼다","나다","나라","나무","나비","나이","내과","내내","내다","내부","내외","내지","너머","너무","너희","노래","노트","누구","누나","뉴스","다리","다소","다수","다시","대가","대개","대구","대기","대다","대로","대비","대사","대체","대표","대화","대회","더위","도구","도로","도마","도시","돼지","되게","되다","두께","두뇌","두다","두부","두세","두어","따다","따로","때로","떼다","뛰다","뜨다","띄다","레저","리그","리터","마구","마디","마루","마리","마주","마치","마크","매너","매다","매우","매주","매체","머리","메뉴","메다","메모","모기","모두","모래","모레","모자","묘사","무게","무기","무늬","무대","무려","무료","무리","무어","미래","미리","미소","미스","미처","미터","바다","바로","바보","바위","바지","바퀴","배구","배다","배우","배추","배치","버스","버터","베개","베다","보고","보다","보도","보리","보수","보조","보호","뵈다","부대","부모","부부","부서","부위","부자","부재","부채","부처","부피","비교","비누","비다","비서","빼다","뿌리","사고","사과","사기","사다","사례","사무","사위","사이","사자","사표","사회","새끼","새다","새로","새우","새해","샤워","서구","서너","서다","서로","서류","서부","세계","세기","세다","세대","세로","세수","세제","세트","소개","소녀","소리","소매","소비","소수","소스","소위","소유","소재","소주","소파","소포","소화","수고","수도","수요","수저","수표","쉬다","스무","스키","스타","시계","시기","시내","시대","시도","시디","시야","시외","시위","싸다","쏘다","쓰다","아기","아까","아내","아냐","아뇨","아니","아래","아마","아무","아빠","아아","아예","아유","아이","아주","아하","애초","야구","야외","야채","얘기","어깨","어느","어디","어때","어머","어서","어제","어찌","여가","여기","여러","여보","여우","여유","여자","예보","예비","예외","예의","오다","오래","오리","오빠","오이","오해","오후","외과","외교","외다","외모","외부","외제","요구","요리","요새","우려","우리","우유","우주","우표","위기","위로","위주","위치","유교","유리","유머","으레","의도","의류","의무","의미","의사","의자","의지","이거","이내","이때","이래","이리","이마","이모","이미","이사","이어","이외","이유","이자","이제","이하","이해","이후","자기","자꾸","자네","자녀","자다","자료","자리","자매","자세","자유","자주","자체","자취","재다","재료","재미","재수","재주","재즈","저거","저기","저리","저자","저희","제비","제사","제시","제의","제자","조개","조기","조사","조카","좌우","주거","주다","주로","주부","주사","주소","주스","주요","주위","주의","주제","주차","쥐다","지구","지다","지대","지도","지시","지위","지지","지폐","지하","지혜","짜다","찌개","찌다","차다","차례","차마","차이","차차","채소","처녀","처리","처지","체조","초기","초대","초보","최고","최대","최소","최저","최초","최후","추가","추다","추위","취미","취소","취재","치과","치다","치료","치마","치아","치즈","카드","카레","카페","커피","켜다","코너","코드","코스","코치","코트","코피","크기","크다","키스","타다","태도","태아","테러","토끼","토대","투자","투표","튀다","파다","파도","파리","파티","펴다","폐지","포도","포크","표시","푸다","프로","피다","피디","피로","피부","피시","피자","피해","하나","하다","하도","하루","하하","해소","해외","허가","허리","허허","호수","호주","화가","화재","화제","회사","회의","회화","효과","효도","효자","후기","후배","후보","후회","휴가","휴지","희다","가까이","가꾸다","가로수","가르다","가리다","가이드","가지다","가하다","개구리","개나리","거꾸로","거두다","거치다","게다가","계시다","고구려","고구마","고르다","고모부","고치다","고프다","교과서","구르다","구하다","귀하다","그나마","그다지","그대로","그래도","그래서","그래야","그러나","그러다","그리고","그리다","그리로","그사이","그저께","그제야","그치다","기대다","기르다","기쁘다","깨우다","깨지다","꺼내다","꺼지다","꾸리다","꾸미다","끼우다","나가다","나누다","나뉘다","나르다","나머지","나쁘다","나서다","나오다","내리다","내쉬다","내주다","너무나","네거리","놔두다","누르다","느끼다","느리다","다니다","다루다","다르다","다지다","다치다","다투다","다하다","대규모","대다수","대도시","대체로","대하다","더구나","더하다","데리다","데우다","데이트","도대체","도리어","도자기","도저히","두르다","뒤지다","드디어","드라마","드리다","디스크","따라서","따르다","때때로","때리다","떠나다","또다시","띄우다","라디오","라이터","러시아","레이저","로터리","마누라","마르다","마무리","마사지","마시다","마이크","마치다","메시지","메우다","며느리","모니터","모르다","모시다","모으다","모이다","모조리","무더위","무지개","미디어","미루다","미치다","바가지","바구니","바꾸다","바뀌다","바나나","바라다","바르다","바쁘다","바치다","배우다","배우자","버리다","버티다","보고서","보내다","보너스","보이다","보자기","부르다","부치다","비기다","비디오","비로소","비비다","비싸다","비우다","비추다","비치다","비키다","비하다","빠르다","빠지다","뿌리다","사귀다","사나이","사무소","사투리","사회자","새기다","새로이","새소리","새우다","서비스","서서히","세미나","세우다","소규모","소나기","소나무","소비자","소시지","소아과","소유자","쇠고기","수시로","수화기","스스로","스웨터","스위치","스치다","스포츠","시리즈","시부모","시키다","싸구려","싸우다","쓰레기","쓰이다","씌우다","아가씨","아끼다","아니다","아니야","아니요","아마도","아무개","아무리","아버지","아시아","아이고","아저씨","아파트","아프다","애쓰다","야하다","어기다","어느새","어리다","어머니","어저께","어째서","어쩌다","어찌나","에너지","여기다","여쭈다","예쁘다","오가다","오로지","오르다","오페라","오히려","외우다","외치다","요리사","웨이터","위아래","위하다","의외로","의하다","이기다","이대로","이따가","이래서","이러다","이루다","이르다","이미지","이야기","이어서","이제야","자라다","자르다","자세히","재우다","재채기","저고리","저러다","저마다","제대로","제자리","제주도","조르다","조미료","주머니","지나다","지내다","지니다","지도자","지르다","지우개","지우다","지치다","지키다","지하도","찌꺼기","찌르다","차라리","차리다","채우다","체하다","초보자","취하다","치르다","치우다","카메라","캐나다","커지다","켜지다","코끼리","코미디","쿠데타","키우다","타자기","태우다","터지다","테니스","테스트","테이프","토마토","토하다","튀기다","트이다","티브이","티셔츠","퍼지다","펴내다","포도주","포스터","푸르다","피아노","피우다","피하다","피해자","해내다","해마다","헤매다","화나다","흐르다","흐리다","가려지다","가르치다","가리키다","가져가다","가져오다","거대하다","거부하다","게으르다","고려하다","고소하다","고요하다","귀가하다","그때그때","그러니까","그러므로","그러하다","그려지다","그리하여","그제서야","기다리다","기대되다","기대하다","기도하다","기뻐하다","기여하다","기초하다","깨뜨리다","깨어나다","깨어지다","나빠지다","나아가다","나아지다","나타나다","나타내다","내다보다","내려가다","내려오다","내려지다","내버리다","내보내다","노래하다","느껴지다","다가가다","다가서다","다가오다","다녀가다","다녀오다","다이어트","대기하다","대비하다","대처하다","대표하다","대화하다","데려가다","데려오다","도와주다","돼지고기","두드리다","뒤따르다","드러나다","디자이너","따라가다","따라오다","따로따로","따스하다","떠나가다","떠나오다","떠오르다","뛰어가다","뛰어나다","뛰어오다","마요네즈","마주치다","머무르다","모자라다","묘사하다","무너지다","무리하다","무사하다","무시하다","미워하다","바라보다","바이러스","배고프다","배부르다","버려지다","보고하다","보내오다","보도되다","보도하다","보호되다","보호하다","부러지다","부서지다","비교하다","빠뜨리다","뿌리치다","사과하다","사라지다","사소하다","사이사이","사회주의","서두르다","서투르다","세워지다","소개되다","소개하다","소리치다","소비하다","소요되다","소유하다","소화하다","수고하다","수리하다","스케이트","스튜디오","스트레스","시나리오","시내버스","시도하다","시아버지","시어머니","시외버스","쓰러지다","아니하다","아무래도","아이디어","아주머니","아프리카","얘기하다","어떠하다","어쩌다가","어찌하다","여겨지다","여기저기","여보세요","예고하다","예매하다","오래되다","와이셔츠","요구되다","요구하다","요리하다","우리나라","우수하다","우아하다","위대하다","위로하다","위치하다","유리하다","유사하다","유의하다","유지되다","유지하다","의미하다","의지하다","이러하다","이뤄지다","이리저리","이사하다","이어지다","이해되다","이해하다","자라나다","자세하다","저지르다","제거하다","제대하다","제시되다","제시하다","제외되다","제외하다","제의하다","조사하다","조화되다","주무시다","주어지다","주요하다","주의하다","주차하다","지나가다","지나치다","지도하다","지루하다","지배하다","지시하다","지워지다","지켜보다","쳐다보다","초대하다","초조하다","추가되다","추가하다","취소하다","치료하다","코스모스","타고나다","타오르다","태어나다","터뜨리다","파괴하다","포기하다","표시하다","피로하다","하나하나","하드웨어","해소하다","헤아리다","헤어지다","호주머니","화려하다","효도하다","후회하다","흐려지다","가까워지다","가져다주다","괴로워하다","그리워하다","나누어지다","내려다보다","더러워지다","두드러지다","두려워하다","따라다니다","뛰어나가다","뛰어나오다","뛰어내리다","뛰어다니다","뛰어오르다","무의미하다","미끄러지다","부러워하다","빠져나가다","빠져나오다","소프트웨어","아르바이트","어두워지다","어려워지다","오르내리다","이루어지다","이야기하다","조그마하다","크리스마스","튀어나오다","계좌이체","기계수리","기소유예","기우","미사여구","부도처리","부지기수","사기피해","수어지교","수주대토","시계수리","시시비비","아래","애매모호","어부지리","우회도로","의료기기","자유자재","자포자기","좌지우지","지기지우","지위고하","지하보도","지하차도","퇴사처리","하자보수","호가호위","호사다마","호사유피","화기애애","화재대피","화재주의","효시", "가재","가지","거위","계피","고래","고수","고추","까치","노새","대구","대파","도미","돼지","라마","매미","메기","배추","부추","비트","사과","사자","새우","소라","여우","오리","오이","이끼","자두","제비","조개","체리","치타","키위","타조","토끼","포도","퓨마","해마","해초","호두","여뀌","가리비","가자미","개구리","개나리","고구마","고라니","구아바","기러기","까마귀","꾀꼬리","너구리","다시마","대나무","데이지","도도새","두꺼비","두더지","두루미","따개비","매너티","메뚜기","무화과","바나나","소나무","아메바","코끼리","코브라","코요테","키위새","토마토","해파리","수세미","가래나무","가시나무","계수나무","느티나무","대추나무","대추야자","라즈베리","로즈마리","메추라기","미루나무","바다사자","버드나무","아네모네","아보카도","야자나무","오레가노","코스모스","티크나무","파프리카","페튜니아","프리지아","하이에나","해바라기","해오라기","호두나무","가시고기","프리지아","해바라기","가래나무","가마우지","도꼬마리","고로쇠나무","바다코끼리","히비스커스","고로쇠나무"
  ];
       

  // ——— 한글 분해/조립 유틸 ———
  const CHO_LIST = "ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌ ㅍㅎ".replace(" ", "").split("");
  const JUNG_LIST = ["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];
  const JONG_LIST  = ["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
  const COMPOUND_JONG = {"ㄳ":["ㄱ","ㅅ"],"ㄵ":["ㄴ","ㅈ"],"ㄶ":["ㄴ","ㅎ"],"ㄺ":["ㄹ","ㄱ"],"ㄻ":["ㄹ","ㅁ"],"ㄼ":["ㄹ","ㅂ"],"ㄽ":["ㄹ","ㅅ"],"ㄾ":["ㄹ","ㅌ"],"ㄿ":["ㄹ","ㅍ"],"ㅀ":["ㄹ","ㅎ"],"ㅄ":["ㅂ","ㅅ"]};

  function decomposeChar(ch){
    const code = ch.charCodeAt(0);
    const base = code - 0xAC00;
    if (base < 0 || base > 11171) return null;
    const cho  = Math.floor(base / 588);
    const jung = Math.floor((base % 588) / 28);
    const jong = base % 28;
    const arr = [
      { slot: "초", jamo: CHO_LIST[cho] },
      { slot: "중", jamo: JUNG_LIST[jung] }
    ];
    const jongSym = JONG_LIST[jong];
    if (jongSym) {
      const parts = COMPOUND_JONG[jongSym];
      if (parts) parts.forEach(p => arr.push({ slot: "종", jamo: p }));
      else arr.push({ slot: "종", jamo: jongSym });
    }
    return arr;
  }

  function getConsonantItems(word){
    const items = [];
    const chars = [...word];
    for (let i = 0; i < chars.length; i++){
      const parts = decomposeChar(chars[i]);
      if (!parts) return null;
      let jongIndex = 0;
      for (const p of parts){
        if (p.slot === "중") continue;
        const idx = (p.slot === "종") ? (jongIndex++) : 0;
        items.push({ i, slot: p.slot, idx, jamo: p.jamo });
      }
    }
    return items;
  }

  function decomposeWordToJamo(word){
    const perSyllable = [], flat = [], consonants = [], vowels = [], choSeq = [];
    const chars = [...word];
    for (let i=0;i<chars.length;i++){
      const d = decomposeChar(chars[i]);
      if (!d) return null;
      perSyllable.push(d);
      let choHere = null;
      for (const x of d) {
        flat.push(x.jamo);
        if (x.slot === "중") vowels.push(x.jamo);
        else {
          consonants.push(x.jamo);
          if (x.slot === "초") choHere = x.jamo;
        }
      }
      choSeq.push(choHere);
    }
    return { perSyllable, flat, vowels, consonants, choSeq };
  }

  function countMap(arr){ const m=new Map(); for(const k of arr) m.set(k,(m.get(k)||0)+1); return m; }

  // ——— 상태 ———
  let secret = "", tries = 0, finished = false;
  let modeLen = null, guessed = new Set();
  let secretDecomp = null;

  // 자음 키보드 (초성 19자)
  const KB_CONSONANTS = "ㄱ ㄲ ㄴ ㄷ ㄸ ㄹ ㅁ ㅂ ㅃ ㅅ ㅆ ㅇ ㅈ ㅉ ㅊ ㅋ ㅌ ㅍ ㅎ".split(" ");
  const keyStates = new Map();

  function renderKeyboard(){
    kbEl.innerHTML = "";
    KB_CONSONANTS.forEach(j=>{
      const div = document.createElement("div");
      div.className = "key " + (keyStates.get(j) || "idle");
      div.textContent = j;
      div.title = "자음 상태 표시";
      kbEl.appendChild(div);
    });
  }

  function updateKeyStateFromGuess(guessWord){
    const secretConsSet = new Set(getConsonantItems(secret).map(x=>x.jamo));
    const usedCon = new Set(getConsonantItems(guessWord).map(x=>x.jamo));
    usedCon.forEach(c=>{
      const prev = keyStates.get(c) || "idle";
      const now = secretConsSet.has(c) ? "hit" : "out";
      keyStates.set(c, (prev === "hit") ? "hit" : now);
    });
    renderKeyboard();
  }

  // ——— 모드 버튼: active 토글 + 배지 제거 버전 ———
  const modeButtons = ["m2","m3","m4","m5"].map(id=>$("#"+id));
  modeButtons.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      modeButtons.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      modeLen = parseInt(btn.id.slice(1),10);
      reset();
    });
  });

  function pickSecret() {
    const cand = WORDS.filter(w => /^[가-힣]+$/.test(w) && [...w].length === modeLen);
    if (cand.length === 0) return randomHangulWord(modeLen);
    return cand[Math.floor(Math.random()*cand.length)];
  }

  function randomHangulWord(n){
    let s = "";
    while ([...s].length < n){
      const code = 0xAC00 + Math.floor(Math.random()*(0xD7A4-0xAC00));
      s += String.fromCharCode(code);
    }
    return s;
  }

  function reset() {
    if (!modeLen) { warnEl.textContent = "먼저 글자 수를 선택하세요."; return; }
    secret = pickSecret();
    secretDecomp = decomposeWordToJamo(secret);
    tries = 0; finished = false; guessed.clear();
    tbody.innerHTML = "";
    statusEl.textContent = "진행 중";
    statusEl.classList.remove("ok","fail");
    summaryEl.textContent = ""; warnEl.textContent = "";
    guessEl.value = ""; btnTry.disabled = true;
    guessEl.placeholder = "모음 힌트와 같은 단어를 입력";
    // 모음 힌트(모음 시퀀스)
    const hint = secretDecomp.vowels.join("");
    vowelHintEl.textContent = `모음 힌트: ${hint}`;
    // 키보드 초기화
    keyStates.clear(); KB_CONSONANTS.forEach(c=>keyStates.set(c,"idle")); renderKeyboard();
    guessEl.focus();
    updateButtons(false);
  }

  function validate(input) {
    if (!modeLen) return "먼저 글자 수를 선택하세요.";
    if (!/^[가-힣]+$/.test(input)) return "완성형 한글만 입력하세요. (가–힣)";
    if ([...input].length !== modeLen) return `${modeLen}글자를 정확히 입력하세요.`;
    const g = decomposeWordToJamo(input);
    const hint = secretDecomp.vowels;
    for (let i=0;i<hint.length;i++){
      const gs = g.perSyllable[i].find(x=>x.slot==="중").jamo;
      if (gs !== hint[i]) return "힌트와 모음이 같아야 합니다.";
    }
    return "";
  }

  function scoreByConsonants(guess, secret){
    const gi = getConsonantItems(guess);
    const si = getConsonantItems(secret);
    if (!gi || !si) return { S:0, B:0, OUT:0, gi:null, si:null };

    let S = 0;
    const usedS = new Array(si.length).fill(false);
    const usedG = new Array(gi.length).fill(false);

    for (let gk = 0; gk < gi.length; gk++){
      const g = gi[gk];
      for (let sk = 0; sk < si.length; sk++){
        const s = si[sk];
        if (usedS[sk]) continue;
        if (g.i === s.i && g.slot === s.slot && g.idx === s.idx && g.jamo === s.jamo){
          usedS[sk] = true; usedG[gk] = true; S++;
          break;
        }
      }
    }

    const gLeft = []; const sLeft = [];
    for (let k=0;k<gi.length;k++) if (!usedG[k]) gLeft.push(gi[k].jamo);
    for (let k=0;k<si.length;k++) if (!usedS[k]) sLeft.push(si[k].jamo);

    const gMap = countMap(gLeft);
    const sMap = countMap(sLeft);
    let overlap = 0;
    for (const [j, gv] of gMap.entries()){
      const sv = sMap.get(j) || 0;
      overlap += Math.min(gv, sv);
    }
    const B = overlap;
    const OUT = Math.max(0, gi.length - (S + B));
    return { S, B, OUT };
  }


// 개별 자모 단위로 S/B/O 라벨링 후, 음절별 구조로 정리
function labelPerConsonant(guess, secret){
  const gi = getConsonantItems(guess);
  const si = getConsonantItems(secret);
  if (!gi || !si) return { perSyl: [], S:0, B:0, OUT:0 };

  const usedS = new Array(si.length).fill(false);
  const usedG = new Array(gi.length).fill(false);
  const labels = new Array(gi.length).fill("o"); // 기본 O
  let S=0, B=0;

  // 1) 정확 위치·슬롯·자모 일치 = S
  for (let gk=0; gk<gi.length; gk++){
    const g = gi[gk];
    for (let sk=0; sk<si.length; sk++){
      const s = si[sk];
      if (usedS[sk]) continue;
      if (g.i===s.i && g.slot===s.slot && g.idx===s.idx && g.jamo===s.jamo){
        usedS[sk] = true; usedG[gk] = true;
        labels[gk] = "s"; S++;
        break;
      }
    }
  }

  // 2) 위치는 다르지만 같은 자모 존재 = B (남은 것끼리)
  for (let gk=0; gk<gi.length; gk++){
    if (usedG[gk]) continue;
    const g = gi[gk];
    let found = -1;
    for (let sk=0; sk<si.length; sk++){
      if (usedS[sk]) continue;
      if (si[sk].jamo === g.jamo) { found = sk; break; }
    }
    if (found !== -1){
      usedS[found] = true; usedG[gk] = true;
      labels[gk] = "b"; B++;
    }
  }

  const OUT = gi.length - (S+B);

  // 3) 음절별 구조로 재그룹 (초/종(겹받침 인덱스) 순)
  const perSyl = [];   // index = 음절 위치
  for (let idx=0; idx<gi.length; idx++){
    const g = gi[idx];
    if (!perSyl[g.i]) perSyl[g.i] = { cho:null, jongs:[] };
    if (g.slot === "초") {
      perSyl[g.i].cho = labels[idx];
    } else { // 종성 (겹받침 idx 0,1,…)
      perSyl[g.i].jongs[g.idx] = labels[idx];
    }
  }
  return { perSyl, S, B, OUT };
}

function renderResultBoxes(guess, perSyl){
  const wrap = document.createElement("div");
  wrap.className = "result";

  const chars = [...guess];
  for (let i=0; i<chars.length; i++){
    const sy = document.createElement("div");
    sy.className = "sy";

    // 초성
    const rowCho = document.createElement("div");
    rowCho.className = "slot-row";
    const slotCho = document.createElement("div");
    slotCho.className = "slot " + ((perSyl[i] && perSyl[i].cho) ? perSyl[i].cho : "o");
    slotCho.textContent = slotCho.classList.contains("s") ? "S" :
                          slotCho.classList.contains("b") ? "B" : "O";
    rowCho.appendChild(slotCho);
    sy.appendChild(rowCho);

    // 종성(겹받침)
    const rowJong = document.createElement("div");
    rowJong.className = "slot-row";
    const parts = decomposeChar(chars[i]) || [];
    const jongLabels = (perSyl[i] && perSyl[i].jongs) ? perSyl[i].jongs : [];
    const countJong = parts.filter(p=>p.slot==="종").length;
    for (let j=0; j<countJong; j++){
      const slot = document.createElement("div");
      const lab = jongLabels[j] || "o";
      slot.className = "slot " + lab;
      slot.textContent = (lab==="s"?"S": lab==="b"?"B":"O");
      rowJong.appendChild(slot);
    }
    if (countJong>0) sy.appendChild(rowJong);

    wrap.appendChild(sy);
  }
  return wrap;
}

function addRow(guess, perSylForBoxes) {
  const tr = document.createElement("tr");
  const tdIdx = document.createElement("td");
  const tdGuess = document.createElement("td");
  const tdRes = document.createElement("td");

  tdIdx.textContent = tries;
  tdGuess.innerHTML = `<strong>${guess}</strong>`;

  // 결과 박스만 추가
  const boxes = renderResultBoxes(guess, perSylForBoxes);
  tdRes.appendChild(boxes);

  tr.appendChild(tdIdx);
  tr.appendChild(tdGuess);
  tr.appendChild(tdRes);
  tbody.prepend(tr);
}


  function onTry() {
    if (finished || !modeLen) return;
    const g = guessEl.value.trim();
    const err = validate(g);
    if (err) { warnEl.textContent = err; guessEl.focus(); return; }
    if (guessed.has(g)) { warnEl.textContent = "이 단어는 이미 시도하셨습니다."; guessEl.focus(); return; }

    warnEl.textContent = "";
    guessed.add(g); tries++;

    
const { perSyl } = labelPerConsonant(g, secret);
addRow(g, perSyl);

    updateKeyStateFromGuess(g);

    if (g === secret) {
      finished = true;
      statusEl.textContent = `정답! (${secret})`;
      statusEl.classList.add("ok");
      summaryEl.textContent = `시도 횟수: ${tries}번`;
      btnTry.disabled = true;
      updateButtons(true);
    } else {
      summaryEl.textContent = `시도 ${tries}번`;
    }

    guessEl.value = ""; btnTry.disabled = true; guessEl.focus();
  }

  function giveUp() {
    if (finished || !modeLen) return;
    finished = true;
    statusEl.textContent = `포기! 정답: ${secret}`;
    statusEl.classList.add("fail");
    btnTry.disabled = true;
    updateButtons(true);
  }

  function updateButtons(isFinished) {
    btnTry.classList.toggle("primary", !isFinished);
    btnTry.classList.toggle("secondary", isFinished);
    btnReset.classList.toggle("primary", isFinished);
    btnReset.classList.toggle("secondary", !isFinished);
    btnReset.classList.toggle("attention", isFinished);
  }

  function onInput(e) {
    let v = e.target.value.replace(/\s+/g,"");
    e.target.value = v;
    const err = v ? validate(v) : "먼저 단어를 입력하세요.";
    btnTry.disabled = !!v && !!err;
    warnEl.textContent = (v && err) ? err : "";
  }

  guessEl.addEventListener("input", onInput);
  guessEl.addEventListener("keydown", e => { if (e.key === "Enter" && !btnTry.disabled) onTry(); });
  btnTry.addEventListener("click", onTry);
  btnReset.addEventListener("click", reset);
  btnGiveup.addEventListener("click", giveUp);
})();
</script>
</body>
</html>
