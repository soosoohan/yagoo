<!DOCTYPE html>
<html lang="ko">
<head>
<!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4YZHC1G9FN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4YZHC1G9FN');
    </script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>수수한글야구기본</title>
<style>
  :root { --bg:#0b1520; --card:#122233; --accent:#6ee7ff; --muted:#9db3c7;
          --hit:#8fd3ff; --out:#ff9bb3; --idle:#7b8ea3; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui, sans-serif; background: var(--bg); color:#eef6ff; display:flex; min-height:100vh; }
  .wrap { margin:auto; width:min(820px, 100%); padding:24px; }
  .card { background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:22px; box-shadow: 0 10px 30px rgba(0,0,0,.35);}
  h1 { margin:0 0 8px; font-size: 25px;}
  .sub { color:var(--muted); margin-bottom:18px; font-size: 20px; }
  .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

  input {
    font: inherit;
    padding: 14px 16px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: #0f1c2a;
    color: #e9f5ff;
    text-align: center;
    min-width:260px;
    font-size:20px;
  }
  button { cursor:pointer; border:0; border-radius:12px; padding:12px 16px; font-size:18px; }
  .primary { background:var(--accent); color:#00121d; }
  .secondary { background:#2c4157; color:#d7e7f5; }
  .ghost { background:transparent; color:var(--muted); border:1px dashed rgba(255,255,255,.2); }
  button:disabled { opacity:.45; cursor:not-allowed; }
  .hint { margin-top:10px; color:#c7d9eb; font-size:20px;}
  .warn { margin-top:6px; color:#ffb8c1; font-size:20px; min-height:1.3em; }
  .log { margin-top:18px; background:#0f1c2a; border-radius:14px; border:1px solid rgba(255,255,255,.08); max-height:46vh; overflow:auto;}
  .log table { width:100%; border-collapse:collapse; font-variant-numeric: tabular-nums; font-size:18px; }
  .log th, .log td { padding:12px 12px; border-bottom:1px solid rgba(255,255,255,.06); text-align:center; }
  .log tr:last-child td { border-bottom:0; }
  .badge { display:inline-block; border-radius:12px; padding:8px 12px; font-size:20px; background:#21415c; color:#d7e7f5;}
  .ok { color:#b8ffb8; }
  .fail { color:#ffb8c1; }
  .attention { animation: pulse 1.2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.03)} }

  /* 모드 버튼 active 스타일 */
  .mode-buttons { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
  .mode-buttons .secondary.active {
    background: var(--accent);
    color: #00121d;
    font-weight: 700;
    box-shadow: 0 0 0 2px rgba(110,231,255,.25) inset;
  }

  /* 자음 키보드 */
  .kb { margin-top:14px; display:grid; grid-template-columns: repeat(auto-fit, minmax(44px,1fr)); gap:8px; }
  .key {
    padding:10px 8px; border-radius:10px; text-align:center; font-size:20px;
    background:#1a2f44; color:#d0ddea; border:1px solid rgba(255,255,255,.08);
    user-select:none;
  }
  .key.idle { background:#1a2430; color:#d0ddea; border-color:rgba(255,255,255,.1); }
  .key.hit  { background:var(--hit); color:#062033; border-color:transparent; font-weight:700; }
  .key.out  { background:#f2c9d4; color:#3a0010; border-color:transparent; font-weight:700; }
  .flex { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
/* 결과 칸: 음절별(S/B/O) 박스 */


.result { display:flex; gap:8px; justify-content:center; }
.sy {
  display:flex; flex-direction:column; gap:4px; align-items:center;
}
.sy .slot-row { display:flex; gap:4px; }
.sy .slot {
  border:1px solid rgba(255,255,255,.25);
  border-radius:6px; padding:2px 4px;
  font-weight:800; font-size:14px;
  min-width:18px; text-align:center;
}
.sy .slot.s { border-color:#6ee7ff; color:#6ee7ff; }
.sy .slot.b { border-color:#ffd166; color:#ffd166; }
.sy .slot.o { border-color:#8697a9; color:#8697a9; }

</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Soosooland Korean Word Baseball </h1>
    <div class="sub">
A game where you guess the secret Korean word chosen by the computer.<br>
S: Consonant exists and position matches <br> B: Consonant exists but wrong position <br>O: Consonant does not exist<br>
The game ends when you guess the word correctly or use up all attempts.
    </div>

    <div class="mode-buttons">
      <button class="secondary" id="m2">2 letters</button>
  <button class="secondary" id="m3">3 letters</button>
  <button class="secondary" id="m4">4 letters</button>
       </div>

    <div class="flex" style="margin-bottom:8px;">
      <!-- 모드 배지 제거: “2글자” 같은 표시를 없앰 -->
      <span id="vowelHint" class="hint"></span>
    </div>

    <div class="row">
      <input id="guess" autocomplete="off" placeholder="Enter a word with the same vowels as the hint" />
      <button id="btn-try" class="primary" disabled>Submit</button>
      <button id="btn-reset" class="secondary">New Game</button>
      <button id="btn-giveup" class="ghost">Give up</button>
      <span id="status" class="badge">Select word length.</span>
      <span id="summary" class="hint"></span>
    </div>
    <div id="warn" class="warn"></div>

    <div class="log">
      <table>
        <thead>
          <tr><th>#</th><th>Guess</th><th>Result</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="hint">Consonants hint keyboard : <span class="key idle" style="padding:2px 8px;">Not tried</span> <span class="key hit" style="padding:2px 8px;">Exists:S/B</span> <span class="key out" style="padding:2px 8px;">Not exists:OUT</span></div>
    <div id="kb" class="kb" aria-label="Consonants hint"></div>
  </div>
</div>

<script>
(function () {
  const $ = sel => document.querySelector(sel);
  const guessEl = $("#guess"), tbody = $("#tbody"), statusEl = $("#status"),
        summaryEl = $("#summary"), btnTry = $("#btn-try"),
        btnReset = $("#btn-reset"), btnGiveup = $("#btn-giveup"),
        warnEl = $("#warn"), vowelHintEl = $("#vowelHint"),
        kbEl = $("#kb");

  // ——— 단어뱅크: 글자수 섞어서 한 배열로 관리 ———
  // 원래 있던 예시들을 하나로 합침. 여기다 자유롭게 섞어서 추가하세요.
  const WORDS = [
      "가게", "가계부", "가구", "가로등", "가로수", "가루", "가르마", "가르침", "가리개", "가마", "가면", "가방", "가수", "가스", "가슴", "가야금", "가오리", "가요", "가운데", "가위", "가을", "가이드", "가입자", "가재", "가재도구", "가전제품", "가정교사", "가죽", "가지", "가짜", "간식", "간장", "간판", "간호사", "갈비", "갈비탕", "감기", "감독", "감자", "강당", "강물", "강변", "강사", "강수량", "강아지", "강아지풀", "강원도", "개구리", "개나리", "개미", "개울", "개인창고", "개인택시", "거리", "거문고", "거미", "거실", "거울", "거위", "거주지", "거즈", "거짓말", "거품", "건너뛰기", "건넌방", "건물", "걸상", "걸음", "게시판", "게임", "겨울", "겨울철", "겨자", "결혼식", "경기장", "경복궁", "경운기", "경찰관", "경찰서", "경치", "계곡", "계단", "계단주의", "계란", "계산기", "계절", "고개", "고객", "고교", "고구마", "고궁", "고글", "고기", "고등어", "고등학교", "고등학생", "고리", "고모", "고무", "고무신", "고사리", "고속도로", "고속버스", "고양이", "고추", "고추장", "고춧가루", "고치", "고향", "곡식", "골목", "골목길", "골짜기", "골치", "골프", "공간", "공공시설", "공공장소", "공군", "공기", "공동주택", "공무원", "공연장", "공원", "공장", "공주", "공중", "공중전화", "공지사항", "공짜", "공책", "공통점", "공항", "공항버스", "공휴일", "과거", "과외", "과일", "과자", "과학", "과학자", "관객", "관광객", "관광버스", "관광지", "관람객", "관람시간", "광경", "광고", "광복절", "광장", "교과서", "교문", "교복", "교사", "교수", "교실", "교육과정", "교육기관", "교육비", "교육자", "교육자료", "교재", "교통신호", "교포", "교회", "구급함", "구기자차", "구두", "구름", "구리", "구매내역", "구멍", "구호물품", "국가", "국물", "국민", "국수", "국어", "군사", "군인", "굴비", "권투", "귀고리", "귀뚜라미", "그늘", "그래픽", "그릇", "그리기", "그리움", "그림", "그림자", "그저께", "극작가", "극장", "근로자", "근육", "글쓰기", "글씨", "글자", "금고", "금메달", "금연구역", "금융기관", "금은보석", "금자탑", "금잔디", "급수시설", "급식시간", "기념일", "기념품", "기독교", "기둥", "기름", "기분", "기쁨", "기숙사", "기술자", "기업인", "기운", "기자", "기적", "기차", "기초", "기침", "기타", "길거리", "김밥", "김치", "김치볶음", "김치찌개", "까치", "깍두기", "깨달음", "깨소금", "껍질", "꼬리", "꼬마", "꼭대기", "꽃씨", "꽃잎", "나들이", "나라", "나리", "나머지", "나무", "나물", "나뭇가지", "나뭇잎", "나비", "나중", "나침반", "낙엽", "낙지", "낚시", "낚시꾼", "낚싯대", "날개", "날씨", "날짜", "남매", "낱말", "내용물", "내일", "내지", "내후년", "냄비", "냇물", "냉면", "냉장고", "너구리", "너구리​​​​​​​​​​​​​​​​", "넥타이", "노가리", "노동자", "노란색", "노래", "노래방", "노랫소리", "노루", "노리개", "노약자석", "노트", "녹차", "놀이터", "농구", "농부", "농산물", "농장", "농촌", "누나", "눈길", "눈물", "눈썹", "늑대", "늦가을", "다리", "다방", "다양성", "다이어트", "단골", "단소", "단어", "단체급식", "단추", "단풍", "단호박", "달걀", "달력", "달리기", "달무리", "달빛", "달팽이", "담요", "답장", "당근", "당신", "대구", "대기", "대나무", "대도시", "대륙", "대리운전", "대문", "대사관", "대지", "대학교", "대학교수", "대학생", "대학원", "대한민국", "대합실", "더위", "덩어리", "데이트", "도구", "도깨비", "도너츠", "도덕", "도둑", "도로", "도마", "도서관", "도시", "도시락", "도심", "도움말", "도자기", "도장", "도화지", "독감", "독도", "돌멩이", "동그라미", "동네", "동료", "동메달", "동물", "동물병원", "동물원", "동생", "동서남북", "동아리", "동영상", "동전", "동창", "동포", "동화", "동화책", "돼지", "돼지고기", "된서리", "된장", "된장찌개", "두뇌", "두부", "둥지", "뒷문", "뒷산", "드라마", "드라이어", "등기우편", "등대", "등록금", "등록증", "등산", "등산로", "등용문", "디스크", "디자이너", "디자인", "딸기", "땅바닥", "땅콩", "떡국", "떡볶이", "뚜껑", "띠지", "라디오", "라면", "라운드", "라이벌", "라이터", "라인", "라켓", "러시아", "레몬", "레스토랑", "레이저", "렌즈", "로터리", "리듬", "리코더", "마감시간", "마누라", "마늘", "마당", "마디", "마라톤", "마루", "마무리", "마사지", "마요네즈", "마을", "마음", "마음씨", "마이크", "마중", "마지막", "막걸리", "막내", "만두", "만세", "만점", "만화", "만화가", "매미", "맥주", "맨드라미", "머리", "머리말", "머리카락", "먹이", "먼지", "메뉴", "메모", "메시지", "며느리", "멸치", "명령어", "명절", "명함", "모니터", "모래", "모자", "모퉁이", "목걸이", "목소리", "목욕탕", "몸무게", "무게", "무궁화", "무늬", "무대", "무더위", "무릎", "무리", "무서리", "무지개", "문서", "문어", "문자", "문장", "문제점", "문화재", "물감", "물건", "물건값", "물결", "물고기", "물기", "물음", "물질", "물체", "물품", "미네랄", "미디어", "미래", "미루나무", "미소", "미술", "미술관", "미역", "미용실", "미음", "민들레", "밀가루", "밑바닥", "바가지", "바구니", "바나나", "바늘", "바다", "바닥", "바닷가", "바닷물", "바람", "바위", "바이러스", "바이올린", "바지", "바퀴", "바탕", "박물관", "박사", "박수",  "반죽", "반지", "반찬", "받침", "발가락", "발걸음", "발레", "발자국", "발톱", "발판", "밤하늘", "밥그릇", "밥맛", "밥상", "밥솥", "방바닥", "방송국", "방송사", "방아깨비", "방울", "방학", "배경", "배구", "배꼽", "배드민턴", "배송시간", "배수시설", "배수진", "배우", "배우자", "배웅", "배추", "배추김치", "백두산", "백미", "백화점", "뱃사람", "버섯", "버스", "버터", "번개", "베개", "벤치", "벨트", "벼락", "벽지", "변호사", "별명", "병실", "병아리", "병원", "병풍", "보고서", "보너스", "보리수", "보리차", "보석", "보슬비", "보육시설", "보자기", "복도", "복사기", "복숭아", "볶음밥", "볼링", "볼펜", "봄바람", "봉지", "봉투", "부동산", "부리", "부모", "부모님", "부모형제", "부엌", "부잣집", "부채", "부추", "분필", "불고기", "불꽃", "불빛", "불야성", "브랜드", "블라우스", "비누", "비닐", "비닐봉지", "비닐우산", "비둘기", "비디오", "비밀", "비바람", "비빔밥", "비상구", "비상벨", "비상용품", "비상통로", "비서", "비타민", "비행기", "비행장", "빌딩", "빗물", "빗방울", "빗줄기", "빛깔", "빨래", "뿌리", "사계절", "사과", "사나이", "사람", "사마귀", "사모님", "사무소", "사무실", "사무직", "사생활", "사슴", "사업가", "사업자", "사용자", "사위", "사자", "사진", "사진기", "사탕", "사투리", "사회", "사회자", "산기슭", "산토끼", "삼계탕", "상금", "상상력", "상인", "상자", "상점", "상처", "상추", "상표", "상품", "상하수도", "새벽", "새우", "색연필", "샌드위치", "생방송", "생선", "생활비", "샤워​​​​​​​​​​​​​​​​", "서랍", "서류", "서리", "서비스", "서울", "서적", "서점", "서커스", "석유", "선물", "선배", "선생님", "선수", "선원", "선장", "선진국", "선풍기", "설거지", "설날", "설렁탕", "설탕", "성함", "세계", "세금", "세미나", "세상", "세제", "세종대왕", "세탁", "세탁기", "세탁소", "세포", "소고", "소금", "소나기", "소나무", "소녀", "소년", "소라", "소리", "소매", "소비자", "소설", "소설가", "소스", "소식", "소원", "소음", "소지품", "소쿠리", "소포", "소포지", "소풍", "소화기", "소화제", "속담", "손가락", "손님", "손뼉", "손수건", "손잡이", "손톱", "솔잎", "솜씨", "솜씨​​​​​​​​​​​​​​​​", "송아지", "송이", "송편", "수건", "수공업", "수도꼭지", "수돗물", "수로", "수명", "수박", "수세미", "수수", "수업시간", "수염", "수영", "수영장", "수요일", "수입품", "수저", "수표", "수필", "수학", "수험생", "수화기", "숙소", "숙제", "숟가락", "숫자", "슈퍼마켓", "스승", "스웨터", "스위치", "스케이트", "스케줄", "스키", "스키장", "스타일", "스튜디오", "스트레스", "스포츠", "스프", "스프레이", "스피커", "슬픔", "습기", "승객", "승객​​​​​​​​​​​​​​​​", "승리", "승용차", "시각", "시간", "시계", "시골", "시금치", "시나리오", "시내버스", "시냇물", "시래기", "시리즈", "시멘트", "시민", "시부모", "시선", "시스템", "시야", "시외버스", "시인", "시장", "시청률", "시청자", "시험지", "식구", "식기", "식당", "식량", "식료품", "식목일", "식물", "식빵", "식사시간", "식생활", "식용유", "식초", "식탁", "신랑", "신문", "신문기자", "신문사", "신문지", "신발", "신입생", "신제품", "신청서", "신체검사", "신호", "신호등", "신화", "심부름", "심장", "심판", "싸구려", "쌍둥이", "쏘가리", "쐐기", "쓰기", "쓰레기", "쓰레기통", "씨름", "씨앗", "아기", "아나운서", "아내", "아들", "아버지", "아빠", "아스팔트", "아시아", "아이", "아이디어", "아저씨", "아주머니", "아줌마", "아침", "아파트", "아프리카", "악기", "안개", "안경", "안방", "알루미늄", "앞문", "애국가", "액자", "앨범", "야구", "야구장", "야생동물", "약국", "약수", "약품", "양념", "양달", "양말", "양배추", "양복", "양상추", "양파", "어깨", "어둠", "어른", "어린이", "어린이날", "어머니", "어저께", "언니", "언덕", "엄마​​​​​​​​​​​​​​​​", "엉터리", "에너지", "에어컨", "엔진", "여가", "여권", "여름", "여름철", "여우", "여우비", "여직원", "여치", "여행", "여행사", "역사가", "연구소", "연구실", "연극", "연기", "연기자", "연두색", "연락처", "연습", "연어", "연예인", "연장", "연필", "연휴​​​​​​​​​​​​​​​​", "열매", "열무김치", "열쇠", "열차", "엽서", "영구치", "영국", "영어", "영웅", "영혼", "영화", "영화관", "영화배우", "옆구리", "옆집", "예감", "예금", "예술", "예술가", "예습", "예식장", "오늘", "오락​​​​​​​​​​​​​​​​", "오렌지", "오리", "오리알", "오미자차", "오븐", "오빠", "오이", "오전", "오징어", "오토바이", "오페라", "오피스텔", "오후", "옥상", "옥수수", "온도", "온돌", "온라인", "올가을​​​​​​​​​​​​​​​​", "올리고당", "와이셔츠", "외국", "외모", "요가매트", "요금", "요령", "요리", "요리사", "욕실", "욕심", "용기", "용돈", "용돈​​​​​​​​​​​​​​​​", "우거지", "우리", "우리나라", "우산", "우승", "우유", "우정", "우주", "우주여행", "우체부", "우측통행", "우표", "우회도로", "운동", "운동경기", "웅덩이", "원고", "원고지", "월급", "월식", "위성", "유도", "유리", "유머", "유물", "유물유적", "유산", "유적", "유치", "육교", "육군", "율무", "은메달", "은행", "음료", "음반", "음성", "음식", "음악", "의류", "의복", "의사",  "의자", "이름", "이리", "이마", "이모", "이미지", "이불", "이빨", "이사", "이슬", "이야기", "이웃", "이자", "인공위성", "인도", "인물", "인삼", "인쇄소", "인재", "인천공항", "인형", "일기", "일기예보", "일손", "일식", "임금", "입구", "입맛", "입점신청", "잉크", "자녀", "자동차", "자라", "자료", "자리", "자매", "자물쇠", "자연", "자원", "자유", "자율", "자전거", "자정", "자판", "작가", "작은북", "작품", "잔디", "잔치", "잠바", "잠옷", "잡곡", "잡지", "장갑", "장군", "장난감", "장남", "장마", "장미", "장비", "장소", "장애인석", "장작", "재료", "재미", "재산", "저고리", "저녁", "저울", "전광판", "전구", "전기", "전기밥솥", "전시회", "전철", "전통시장", "전통음식", "전통의상", "전화", "전화번호", "전화상담", "점심", "점심시간", "점원", "접근금지", "접수마감", "접수시간", "접시", "정답", "정면", "정문", "정보", "정오", "정원", "정장", "정품", "제비", "제사", "제자", "제주도", "제품", "조각", "조개", "조기", "조깅", "조명", "조상", "조카", "족두리꽃", "졸업", "졸음", "종달새", "종이", "종이봉투", "좌석", "주꾸미", "주머니", "주먹", "주민센터", "주방", "주방세제", "주부", "주사", "주생활", "주소", "주식", "주장", "주차금지", "주택", "준우승", "줄기", "줄다리기", "중고서적", "중고서점", "중식", "중심", "중환자실", "쥐구멍", "즉석", "증거", "지갑", "지구", "지붕", "지우개", "지폐", "지하공간", "지하보도", "지하자원", "지하차도", "지하철", "지하철역", "지혜", "직업", "직원모집", "직장", "진눈깨비",  "차고", "차남", "차량", "차례", "차창", "참새", "참외", "찻잔", "창고", "창구", "창문", "채널", "채소", "책방", "책상", "처마", "처음", "천둥", "천장", "천재", "철도", "청년", "청소", "청춘", "청포도", "체육", "체조", "체중", "초고", "초등학교", "초등학생", "초밥", "초보운전", "초식동물", "촛불", "총각", "총각김치", "촬영금지", "추석", "추수", "추위", "축구", "축제", "출구", "출근시간", "출입금지", "충전금액", "취침시간", "치마", "치아", "치약", "치즈", "친구", "칠면조", "칠판", "카메라", "커피", "코미디", "코스모스", "콤플렉스", "크레파스", "큰북", "클럽", "타조", "탁구", "탁자", "탄수화물", "탈지면", "태권도", "태극기", "태양", "태풍", "탤런트", "탬버린", "터널", "테니스", "토끼", "토대", "토마토", "토요일", "토지", "통로", "튀김", "트럭", "파도", "파리", "파스텔", "파일", "파티", "판사", "팝송", "패션", "팩스", "편지", "포도", "포장지", "포크", "폭포", "풋고추", "풍경", "프로그램", "플라스틱", "피리", "피망", "피부", "피아노", "필름", "필통", "하늘", "하루", "하모니카", "하천", "하품", "학교", "학급", "학생", "학원", "학자", "한글", "한복", "한숨", "한식", "한자", "한지", "할아버지", "함정", "합기도", "항구", "해군", "해답", "해물", "해바라기", "해수욕장", "해안", "해외여행", "해파리", "햇볕", "햇빛", "햇살", "향수", "허리", "현관", "현금", "현미", "혈액", "형사", "형제", "호루라기", "호박", "호주", "호주머니", "호텔", "호흡", "홈페이지", "홍수", "홍익인간", "홍차", "화가", "화려강산", "화면", "화분", "화살", "화재경보", "화폐", "환경오염", "환승통로", "회계사", "회화", "횡단보도", "후춧가루", "훈민정음", "휴가기간", "휴지", "흔적", "희곡"
  ];

  // ——— 한글 분해/조립 유틸 ———
  const CHO_LIST = "ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌ ㅍㅎ".replace(" ", "").split("");
  const JUNG_LIST = ["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];
  const JONG_LIST  = ["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
  const COMPOUND_JONG = {"ㄳ":["ㄱ","ㅅ"],"ㄵ":["ㄴ","ㅈ"],"ㄶ":["ㄴ","ㅎ"],"ㄺ":["ㄹ","ㄱ"],"ㄻ":["ㄹ","ㅁ"],"ㄼ":["ㄹ","ㅂ"],"ㄽ":["ㄹ","ㅅ"],"ㄾ":["ㄹ","ㅌ"],"ㄿ":["ㄹ","ㅍ"],"ㅀ":["ㄹ","ㅎ"],"ㅄ":["ㅂ","ㅅ"]};

  function decomposeChar(ch){
    const code = ch.charCodeAt(0);
    const base = code - 0xAC00;
    if (base < 0 || base > 11171) return null;
    const cho  = Math.floor(base / 588);
    const jung = Math.floor((base % 588) / 28);
    const jong = base % 28;
    const arr = [
      { slot: "초", jamo: CHO_LIST[cho] },
      { slot: "중", jamo: JUNG_LIST[jung] }
    ];
    const jongSym = JONG_LIST[jong];
    if (jongSym) {
      const parts = COMPOUND_JONG[jongSym];
      if (parts) parts.forEach(p => arr.push({ slot: "종", jamo: p }));
      else arr.push({ slot: "종", jamo: jongSym });
    }
    return arr;
  }

  function getConsonantItems(word){
    const items = [];
    const chars = [...word];
    for (let i = 0; i < chars.length; i++){
      const parts = decomposeChar(chars[i]);
      if (!parts) return null;
      let jongIndex = 0;
      for (const p of parts){
        if (p.slot === "중") continue;
        const idx = (p.slot === "종") ? (jongIndex++) : 0;
        items.push({ i, slot: p.slot, idx, jamo: p.jamo });
      }
    }
    return items;
  }

  function decomposeWordToJamo(word){
    const perSyllable = [], flat = [], consonants = [], vowels = [], choSeq = [];
    const chars = [...word];
    for (let i=0;i<chars.length;i++){
      const d = decomposeChar(chars[i]);
      if (!d) return null;
      perSyllable.push(d);
      let choHere = null;
      for (const x of d) {
        flat.push(x.jamo);
        if (x.slot === "중") vowels.push(x.jamo);
        else {
          consonants.push(x.jamo);
          if (x.slot === "초") choHere = x.jamo;
        }
      }
      choSeq.push(choHere);
    }
    return { perSyllable, flat, vowels, consonants, choSeq };
  }

  function countMap(arr){ const m=new Map(); for(const k of arr) m.set(k,(m.get(k)||0)+1); return m; }

  // ——— 상태 ———
  let secret = "", tries = 0, finished = false;
  let modeLen = null, guessed = new Set();
  let secretDecomp = null;

  // 자음 키보드 (초성 19자)
  const KB_CONSONANTS = "ㄱ ㄲ ㄴ ㄷ ㄸ ㄹ ㅁ ㅂ ㅃ ㅅ ㅆ ㅇ ㅈ ㅉ ㅊ ㅋ ㅌ ㅍ ㅎ".split(" ");
  const keyStates = new Map();

  function renderKeyboard(){
    kbEl.innerHTML = "";
    KB_CONSONANTS.forEach(j=>{
      const div = document.createElement("div");
      div.className = "key " + (keyStates.get(j) || "idle");
      div.textContent = j;
      div.title = "자음 상태 표시";
      kbEl.appendChild(div);
    });
  }

  function updateKeyStateFromGuess(guessWord){
    const secretConsSet = new Set(getConsonantItems(secret).map(x=>x.jamo));
    const usedCon = new Set(getConsonantItems(guessWord).map(x=>x.jamo));
    usedCon.forEach(c=>{
      const prev = keyStates.get(c) || "idle";
      const now = secretConsSet.has(c) ? "hit" : "out";
      keyStates.set(c, (prev === "hit") ? "hit" : now);
    });
    renderKeyboard();
  }

  // ——— 모드 버튼: active 토글 + 배지 제거 버전 ———
  const modeButtons = ["m2","m3","m4"].map(id=>$("#"+id));
  modeButtons.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      modeButtons.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      modeLen = parseInt(btn.id.slice(1),10);
      reset();
    });
  });

  function pickSecret() {
    const cand = WORDS.filter(w => /^[가-힣]+$/.test(w) && [...w].length === modeLen);
    if (cand.length === 0) return randomHangulWord(modeLen);
    return cand[Math.floor(Math.random()*cand.length)];
  }

  function randomHangulWord(n){
    let s = "";
    while ([...s].length < n){
      const code = 0xAC00 + Math.floor(Math.random()*(0xD7A4-0xAC00));
      s += String.fromCharCode(code);
    }
    return s;
  }

  function reset() {
    if (!modeLen) { warnEl.textContent = "Please select the word length first."; return; }
    secret = pickSecret();
    secretDecomp = decomposeWordToJamo(secret);
    tries = 0; finished = false; guessed.clear();
    tbody.innerHTML = "";
    statusEl.textContent = "in progress";
    statusEl.classList.remove("ok","fail");
    summaryEl.textContent = ""; warnEl.textContent = "";
    guessEl.value = ""; btnTry.disabled = true;
    guessEl.placeholder = "Enter a word with the same vowels as the hint.";
    // 모음 힌트(모음 시퀀스)
    const hint = secretDecomp.vowels.join("");
    vowelHintEl.textContent = `Hint: ${hint}`;
    // 키보드 초기화
    keyStates.clear(); KB_CONSONANTS.forEach(c=>keyStates.set(c,"idle")); renderKeyboard();
    guessEl.focus();
    updateButtons(false);
  }

  function validate(input) {
    if (!modeLen) return "Please select the word length first.";
    if (!/^[가-힣]+$/.test(input)) return "Please enter only complete Hangul syllables.(가–힣)";
    if ([...input].length !== modeLen) return `${modeLen}Please enter the text accurately.`;
    const g = decomposeWordToJamo(input);
    const hint = secretDecomp.vowels;
    for (let i=0;i<hint.length;i++){
      const gs = g.perSyllable[i].find(x=>x.slot==="중").jamo;
      if (gs !== hint[i]) return "Enter a word with the same vowels as the hint.";
    }
    return "";
  }

  function scoreByConsonants(guess, secret){
    const gi = getConsonantItems(guess);
    const si = getConsonantItems(secret);
    if (!gi || !si) return { S:0, B:0, OUT:0, gi:null, si:null };

    let S = 0;
    const usedS = new Array(si.length).fill(false);
    const usedG = new Array(gi.length).fill(false);

    for (let gk = 0; gk < gi.length; gk++){
      const g = gi[gk];
      for (let sk = 0; sk < si.length; sk++){
        const s = si[sk];
        if (usedS[sk]) continue;
        if (g.i === s.i && g.slot === s.slot && g.idx === s.idx && g.jamo === s.jamo){
          usedS[sk] = true; usedG[gk] = true; S++;
          break;
        }
      }
    }

    const gLeft = []; const sLeft = [];
    for (let k=0;k<gi.length;k++) if (!usedG[k]) gLeft.push(gi[k].jamo);
    for (let k=0;k<si.length;k++) if (!usedS[k]) sLeft.push(si[k].jamo);

    const gMap = countMap(gLeft);
    const sMap = countMap(sLeft);
    let overlap = 0;
    for (const [j, gv] of gMap.entries()){
      const sv = sMap.get(j) || 0;
      overlap += Math.min(gv, sv);
    }
    const B = overlap;
    const OUT = Math.max(0, gi.length - (S + B));
    return { S, B, OUT };
  }


// 개별 자모 단위로 S/B/O 라벨링 후, 음절별 구조로 정리
function labelPerConsonant(guess, secret){
  const gi = getConsonantItems(guess);
  const si = getConsonantItems(secret);
  if (!gi || !si) return { perSyl: [], S:0, B:0, OUT:0 };

  const usedS = new Array(si.length).fill(false);
  const usedG = new Array(gi.length).fill(false);
  const labels = new Array(gi.length).fill("o"); // 기본 O
  let S=0, B=0;

  // 1) 정확 위치·슬롯·자모 일치 = S
  for (let gk=0; gk<gi.length; gk++){
    const g = gi[gk];
    for (let sk=0; sk<si.length; sk++){
      const s = si[sk];
      if (usedS[sk]) continue;
      if (g.i===s.i && g.slot===s.slot && g.idx===s.idx && g.jamo===s.jamo){
        usedS[sk] = true; usedG[gk] = true;
        labels[gk] = "s"; S++;
        break;
      }
    }
  }

  // 2) 위치는 다르지만 같은 자모 존재 = B (남은 것끼리)
  for (let gk=0; gk<gi.length; gk++){
    if (usedG[gk]) continue;
    const g = gi[gk];
    let found = -1;
    for (let sk=0; sk<si.length; sk++){
      if (usedS[sk]) continue;
      if (si[sk].jamo === g.jamo) { found = sk; break; }
    }
    if (found !== -1){
      usedS[found] = true; usedG[gk] = true;
      labels[gk] = "b"; B++;
    }
  }

  const OUT = gi.length - (S+B);

  // 3) 음절별 구조로 재그룹 (초/종(겹받침 인덱스) 순)
  const perSyl = [];   // index = 음절 위치
  for (let idx=0; idx<gi.length; idx++){
    const g = gi[idx];
    if (!perSyl[g.i]) perSyl[g.i] = { cho:null, jongs:[] };
    if (g.slot === "초") {
      perSyl[g.i].cho = labels[idx];
    } else { // 종성 (겹받침 idx 0,1,…)
      perSyl[g.i].jongs[g.idx] = labels[idx];
    }
  }
  return { perSyl, S, B, OUT };
}

function renderResultBoxes(guess, perSyl){
  const wrap = document.createElement("div");
  wrap.className = "result";

  const chars = [...guess];
  for (let i=0; i<chars.length; i++){
    const sy = document.createElement("div");
    sy.className = "sy";

    // 초성
    const rowCho = document.createElement("div");
    rowCho.className = "slot-row";
    const slotCho = document.createElement("div");
    slotCho.className = "slot " + ((perSyl[i] && perSyl[i].cho) ? perSyl[i].cho : "o");
    slotCho.textContent = slotCho.classList.contains("s") ? "S" :
                          slotCho.classList.contains("b") ? "B" : "O";
    rowCho.appendChild(slotCho);
    sy.appendChild(rowCho);

    // 종성(겹받침)
    const rowJong = document.createElement("div");
    rowJong.className = "slot-row";
    const parts = decomposeChar(chars[i]) || [];
    const jongLabels = (perSyl[i] && perSyl[i].jongs) ? perSyl[i].jongs : [];
    const countJong = parts.filter(p=>p.slot==="종").length;
    for (let j=0; j<countJong; j++){
      const slot = document.createElement("div");
      const lab = jongLabels[j] || "o";
      slot.className = "slot " + lab;
      slot.textContent = (lab==="s"?"S": lab==="b"?"B":"O");
      rowJong.appendChild(slot);
    }
    if (countJong>0) sy.appendChild(rowJong);

    wrap.appendChild(sy);
  }
  return wrap;
}

function addRow(guess, perSylForBoxes) {
  const tr = document.createElement("tr");
  const tdIdx = document.createElement("td");
  const tdGuess = document.createElement("td");
  const tdRes = document.createElement("td");

  tdIdx.textContent = tries;
  tdGuess.innerHTML = `<strong>${guess}</strong>`;

  // 결과 박스만 추가
  const boxes = renderResultBoxes(guess, perSylForBoxes);
  tdRes.appendChild(boxes);

  tr.appendChild(tdIdx);
  tr.appendChild(tdGuess);
  tr.appendChild(tdRes);
  tbody.prepend(tr);
}


  function onTry() {
    if (finished || !modeLen) return;
    const g = guessEl.value.trim();
    const err = validate(g);
    if (err) { warnEl.textContent = err; guessEl.focus(); return; }
    if (guessed.has(g)) { warnEl.textContent = "This word has already been tried."; guessEl.focus(); return; }

    warnEl.textContent = "";
    guessed.add(g); tries++;

    
const { perSyl } = labelPerConsonant(g, secret);
addRow(g, perSyl);

    updateKeyStateFromGuess(g);

    if (g === secret) {
      finished = true;
      statusEl.textContent = `Correct! (${secret})`;
      statusEl.classList.add("ok");
      summaryEl.textContent = ``;
      btnTry.disabled = true;
      updateButtons(true);
    } else {
      summaryEl.textContent = ``;
    }

    guessEl.value = ""; btnTry.disabled = true; guessEl.focus();
  }

  function giveUp() {
    if (finished || !modeLen) return;
    finished = true;
    statusEl.textContent = `Out of tries! The answer was ${secret}`;
    statusEl.classList.add("fail");
    btnTry.disabled = true;
    updateButtons(true);
  }

  function updateButtons(isFinished) {
    btnTry.classList.toggle("primary", !isFinished);
    btnTry.classList.toggle("secondary", isFinished);
    btnReset.classList.toggle("primary", isFinished);
    btnReset.classList.toggle("secondary", !isFinished);
    btnReset.classList.toggle("attention", isFinished);
  }

  function onInput(e) {
    let v = e.target.value.replace(/\s+/g,"");
    e.target.value = v;
    const err = v ? validate(v) : "Please enter a word first.";
    btnTry.disabled = !!v && !!err;
    warnEl.textContent = (v && err) ? err : "";
  }

  guessEl.addEventListener("input", onInput);
  guessEl.addEventListener("keydown", e => { if (e.key === "Enter" && !btnTry.disabled) onTry(); });
  btnTry.addEventListener("click", onTry);
  btnReset.addEventListener("click", reset);
  btnGiveup.addEventListener("click", giveUp);
})();
</script>
</body>
</html>
